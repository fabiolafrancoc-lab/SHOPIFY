{% comment %}
  Subscription Success Page ‚Äî /pages/suscripcion-exitosa
  Shown after a successful Shopify Checkout for a digital subscription.

  How to use:
  1. In Shopify Admin ‚Üí Pages, create a page with handle "suscripcion-exitosa".
  2. Set Template: page.suscripcion-exitosa
  3. (Optional) In Shopify Admin ‚Üí Settings ‚Üí Checkout ‚Üí Additional Scripts, add:
       <script>window.location = "/pages/suscripcion-exitosa?order={{order.name}}&email={{customer.email}}";</script>
     to redirect customers here after checkout.

  Webhook placeholder:
  TODO: When a backend/webhook server is available, listen to the
  `subscriptions_contracts/create` webhook (topic) at your endpoint.
  Shopify will POST the new subscription contract JSON including
  customer, selling_plan, and line items. Use this to provision access
  and send welcome emails/WhatsApp codes.
  See: https://shopify.dev/docs/api/admin-rest/latest/resources/webhook
{% endcomment %}

<style>
:root{--bg:#0a0a0f;--bg2:#12121e;--bg3:#16162a;--cyan:#0EA5E9;--magenta:#EC4899;--green:#10B981;--muted:rgba(255,255,255,.58);--w:#fff;}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg);color:var(--w);min-height:100vh;-webkit-font-smoothing:antialiased;}
.serif{font-family:'DM Serif Display',Georgia,serif;}

/* Nav */
.sub-nav{position:sticky;top:0;background:rgba(10,10,15,.95);backdrop-filter:blur(18px);border-bottom:1px solid rgba(255,255,255,.06);z-index:100;padding:16px 20px;}
.sub-nav-in{max-width:800px;margin:0 auto;display:flex;justify-content:center;}
.sub-nav-brand{font-size:22px;font-weight:700;color:var(--w);text-decoration:none;}
.sub-nav-brand span{color:var(--cyan);}

/* Page wrapper */
.sub-page{max-width:680px;margin:0 auto;padding:48px 20px 80px;display:flex;flex-direction:column;align-items:center;gap:32px;}

/* Success icon */
.sub-icon{width:96px;height:96px;background:linear-gradient(135deg,var(--green),#059669);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 0 48px rgba(16,185,129,.4);animation:sub-pulse 2.5s ease-in-out infinite;}
.sub-icon svg{width:48px;height:48px;color:#fff;}
@keyframes sub-pulse{0%,100%{transform:scale(1);box-shadow:0 0 48px rgba(16,185,129,.4);}50%{transform:scale(1.05);box-shadow:0 0 70px rgba(16,185,129,.6);}}

/* Heading */
.sub-heading{text-align:center;}
.sub-title{font-size:clamp(32px,6vw,48px);font-weight:400;background:linear-gradient(135deg,var(--green) 0%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:10px;}
.sub-subtitle{font-size:18px;color:var(--muted);line-height:1.6;}
.sub-greeting{font-size:15px;color:var(--muted);margin-top:8px;display:none;}

/* Card */
.sub-card{width:100%;background:var(--bg3);border-radius:20px;padding:28px 24px;border:1px solid rgba(255,255,255,.07);}
.sub-card-title{font-size:18px;font-weight:700;margin-bottom:20px;color:var(--w);}

/* Trial note */
.sub-trial{display:flex;gap:14px;align-items:flex-start;background:rgba(16,185,129,.07);border:1px solid rgba(16,185,129,.2);border-radius:16px;padding:20px 22px;}
.sub-trial-ico{font-size:26px;flex-shrink:0;}
.sub-trial-txt{font-size:14px;color:rgba(255,255,255,.85);line-height:1.7;}
.sub-trial-txt strong{color:#10B981;}

/* Next steps */
.sub-step{display:flex;gap:14px;padding:18px;background:rgba(255,255,255,.03);border-radius:14px;margin-bottom:10px;border:1px solid rgba(255,255,255,.05);align-items:flex-start;}
.sub-step-num{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--cyan),#0891B2);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:14px;font-weight:700;color:#fff;}
.sub-step-body h4{font-size:15px;font-weight:600;margin-bottom:4px;}
.sub-step-body p{font-size:13px;color:var(--muted);line-height:1.6;}
.sub-step-body a{color:var(--cyan);text-decoration:none;font-weight:600;}
.sub-step-body a:hover{text-decoration:underline;}

/* CTA */
.sub-cta{text-align:center;width:100%;}
.sub-btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;background:linear-gradient(135deg,var(--magenta),#BE185D);color:#fff;font-size:17px;font-weight:700;padding:18px 44px;border-radius:14px;text-decoration:none;transition:all .3s;box-shadow:0 8px 32px rgba(236,72,153,.35);}
.sub-btn:hover{transform:translateY(-2px);box-shadow:0 12px 44px rgba(236,72,153,.5);color:#fff;}
.sub-cta-sub{margin-top:12px;font-size:13px;color:var(--muted);}

/* Confetti */
.sub-confetti{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;overflow:hidden;}
.conf{position:absolute;width:9px;height:9px;opacity:0;animation:conf-fall 4.5s ease-out forwards;}
@keyframes conf-fall{0%{opacity:1;transform:translateY(-80px) rotate(0deg);}100%{opacity:0;transform:translateY(100vh) rotate(760deg);}}

@media(max-width:540px){.sub-btn{width:100%;padding:16px 24px;font-size:15px;}.sub-page{padding:32px 16px 60px;}}
</style>

<!-- Confetti -->
<div class="sub-confetti" id="sub-confetti"></div>

<!-- Nav -->
<nav class="sub-nav">
  <div class="sub-nav-in">
    {% if settings.logo %}
      <img src="{{ settings.logo | img_url: '200x' }}" alt="SaludCompartida" style="height:34px">
    {% else %}
      <a href="/" class="sub-nav-brand">Salud<span>Compartida</span></a>
    {% endif %}
  </div>
</nav>

<div class="sub-page">

  <!-- ‚ë† Icon + Heading -->
  <div class="sub-icon">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
      <polyline points="20 6 9 17 4 12"/>
    </svg>
  </div>

  <div class="sub-heading">
    <h1 class="sub-title serif">¬°Suscripci√≥n Activada!</h1>
    <p class="sub-subtitle">Tu familia en M√©xico ya tiene protecci√≥n m√©dica</p>
    <p class="sub-greeting" id="sub-greeting"></p>
  </div>

  <!-- ‚ë° Free trial confirmation -->
  <div class="sub-trial">
    <div class="sub-trial-ico">üéÅ</div>
    <div class="sub-trial-txt">
      <strong>Primer mes completamente gratis.</strong> No se realiz√≥ ning√∫n cargo hoy.
      A partir del d√≠a 31 se cobrar√°n <strong>$12 USD/mes</strong> de forma autom√°tica.
      Cancela cuando quieras, sin penalizaciones.
    </div>
  </div>

  <!-- ‚ë¢ Next steps -->
  <div class="sub-card">
    <p class="sub-card-title">¬øQu√© sigue?</p>

    <div class="sub-step">
      <div class="sub-step-num">1</div>
      <div class="sub-step-body">
        <h4>Revisa tu email y WhatsApp</h4>
        <p>Te llegar√° un correo con tu c√≥digo personal. Tu familia en M√©xico recibir√° su c√≥digo por WhatsApp.</p>
      </div>
    </div>

    <div class="sub-step">
      <div class="sub-step-num">2</div>
      <div class="sub-step-body">
        <h4>Entra a SaludCompartida</h4>
        <p>Ve a <a href="https://saludcompartida.app" target="_blank" rel="noopener">saludcompartida.app</a>, ingresa tu c√≥digo y accede a tu panel familiar.</p>
      </div>
    </div>

    <div class="sub-step">
      <div class="sub-step-num">3</div>
      <div class="sub-step-body">
        <h4>Comparte el c√≥digo con tu familia</h4>
        <p>Tu familia usa su c√≥digo en la misma app para acceder a telemedicina, farmacia y a su compa√±√≠a (Lupita o Fernanda).</p>
      </div>
    </div>

    <div class="sub-step">
      <div class="sub-step-num">4</div>
      <div class="sub-step-body">
        <h4>Llamada de bienvenida</h4>
        <p>En las pr√≥ximas 24 horas, Lupita o Fernanda llamar√° a tu familia para presentarse y activar los beneficios.</p>
      </div>
    </div>
  </div>

  <!-- ‚ë£ CTA -->
  <div class="sub-cta">
    <a href="https://saludcompartida.app" target="_blank" rel="noopener" class="sub-btn">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
        <polyline points="15 3 21 3 21 9"/>
        <line x1="10" y1="14" x2="21" y2="3"/>
      </svg>
      Ir a saludcompartida.app
    </a>
    <p class="sub-cta-sub">Tu c√≥digo llegar√° al email en unos minutos</p>
  </div>

  <!-- ‚ë§ Back to landing -->
  <p style="font-size:13px;color:var(--muted);text-align:center;">
    <a href="/" style="color:var(--cyan);text-decoration:none;">‚Üê Volver al inicio</a>
  </p>

</div>

<script>
(function () {
  // Confetti
  var container = document.getElementById('sub-confetti');
  var colors = ['#06B6D4','#EC4899','#10B981','#F59E0B','#8B5CF6'];
  for (var i = 0; i < 90; i++) {
    var el = document.createElement('div');
    el.className = 'conf';
    el.style.left = (Math.random() * 100) + '%';
    el.style.animationDelay = (Math.random() * 3.5) + 's';
    el.style.backgroundColor = colors[Math.floor(Math.random() * 5)];
    el.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
    container.appendChild(el);
  }
  setTimeout(function () { container.style.display = 'none'; }, 7000);

  // Personalised greeting from URL params (set by Shopify checkout redirect or sessionStorage)
  var params = new URLSearchParams(window.location.search);
  var firstName = params.get('nombre') || params.get('first_name');
  if (!firstName) {
    try {
      var s1 = JSON.parse(sessionStorage.getItem('sc_step1') || '{}');
      firstName = (s1.nombre || '').split(' ')[0];
    } catch (e) {}
  }
  if (firstName) {
    var greet = document.getElementById('sub-greeting');
    greet.textContent = '¬°Bienvenido, ' + firstName + '!';
    greet.style.display = 'block';
  }
})();
</script>

{% schema %}
{
  "name": "Suscripci√≥n Exitosa",
  "settings": []
}
{% endschema %}
