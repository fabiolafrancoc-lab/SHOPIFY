{% comment %}
  main-redirect-registro.liquid
  ─────────────────────────────────────────────────────────────────────────────
  Step 3 of the registration flow: confirms the plan and triggers subscription
  checkout via Shopify Cart API (POST /cart/clear.js → /cart/add.js with
  selling_plan → /checkout).

  NOTE: The legacy `checkout_url` setting (/cart/…) is intentionally NOT used
  for the checkout button. It is kept in the schema only to avoid breaking the
  Theme Editor for stores that had it configured. The button always uses the
  sc-checkout-subscription snippet, which attaches the selling_plan correctly.
{% endcomment %}

{%- liquid
  assign _variant_id      = settings.shopify_variant_basico      | default: 42695875788877
  assign _selling_plan_id = settings.shopify_selling_plan_basico | default: 7685865549
-%}

<section class="sc-redirect-registro">
  <div class="sc-page-wrap">

    <div class="sc-step-badge">Paso 3 de 3</div>

    <h1 class="sc-page-title">¡Ya casi listo!</h1>
    <p class="sc-page-subtitle">
      Revisa tu plan y completa el pago seguro.<br>
      <strong style="color: var(--cyan, #22d3ee);">Primer mes completamente gratis.</strong>
    </p>

    <div class="sc-plan-summary">
      <div class="sc-plan-summary-row">
        <span class="sc-plan-label">Plan</span>
        <span class="sc-plan-value">Básico — $12/mes</span>
      </div>
      <div class="sc-plan-summary-row">
        <span class="sc-plan-label">Hoy pagas</span>
        <span class="sc-plan-value sc-free">$0.00 — GRATIS</span>
      </div>
      <div class="sc-plan-summary-row">
        <span class="sc-plan-label">Primer cobro</span>
        <span class="sc-plan-value">En 30 días</span>
      </div>
    </div>

    {% render 'sc-checkout-subscription',
       variant_id: _variant_id,
       selling_plan_id: _selling_plan_id,
       btn_label: 'Continuar al Pago Seguro →'
    %}

    <div class="cta-subtext" style="margin-top:16px;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
      Pago 100% seguro con Shopify · Cancela cuando quieras
    </div>

  </div>
</section>

<style>
.sc-redirect-registro {
  display: flex;
  justify-content: center;
  padding: 48px 16px 80px;
}
.sc-redirect-registro .sc-page-wrap {
  width: 100%;
  max-width: 480px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  text-align: center;
}
.sc-redirect-registro .sc-step-badge {
  display: inline-block;
  background: rgba(34,211,238,0.12);
  color: var(--cyan, #22d3ee);
  border: 1px solid rgba(34,211,238,0.3);
  border-radius: 999px;
  padding: 4px 16px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.sc-redirect-registro .sc-plan-summary {
  width: 100%;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 12px;
  padding: 16px 20px;
  margin: 16px 0 8px;
}
.sc-redirect-registro .sc-plan-summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 0;
  font-size: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}
.sc-redirect-registro .sc-plan-summary-row:last-child {
  border-bottom: none;
}
.sc-redirect-registro .sc-plan-label {
  opacity: 0.6;
}
.sc-redirect-registro .sc-plan-value {
  font-weight: 600;
}
.sc-redirect-registro .sc-free {
  color: var(--cyan, #22d3ee);
}
.sc-redirect-registro .sc-checkout-wrap {
  width: 100%;
  margin-top: 8px;
}
.sc-redirect-registro .sc-checkout-btn {
  width: 100%;
}
</style>

{% schema %}
{
  "name": "Registro — Pago",
  "settings": [
    {
      "type": "text",
      "id": "checkout_url",
      "label": "Checkout URL (deprecado)",
      "info": "⚠️ Este campo ya no se utiliza para el botón de pago. El botón siempre usa la Cart API con selling_plan. Mantenido por compatibilidad con el customizador."
    },
    {
      "type": "text",
      "id": "supabase_url",
      "label": "Supabase URL",
      "info": "URL del proyecto Supabase. Ej: https://xxxx.supabase.co"
    },
    {
      "type": "text",
      "id": "supabase_anon_key",
      "label": "Supabase Anon Key",
      "info": "Clave pública (anon/public) de Supabase."
    }
  ],
  "presets": [
    {
      "name": "Registro — Pago"
    }
  ]
}
{% endschema %}
